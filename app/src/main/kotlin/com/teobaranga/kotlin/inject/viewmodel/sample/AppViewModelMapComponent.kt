package com.teobaranga.kotlin.inject.viewmodel.sample

import androidx.lifecycle.SavedStateHandle
import androidx.lifecycle.ViewModel
import com.teobaranga.kotlin.inject.viewmodel.runtime.ContributesViewModel
import me.tatarka.inject.annotations.Provides
import software.amazon.lastmile.kotlin.inject.anvil.AppScope
import software.amazon.lastmile.kotlin.inject.anvil.ContributesTo
import software.amazon.lastmile.kotlin.inject.anvil.ForScope
import software.amazon.lastmile.kotlin.inject.anvil.SingleIn
import kotlin.reflect.KClass

/**
 * Only used for testing in order to expose the 3 ViewModel maps generated by [ContributesViewModel] when
 * applied to various kinds of ViewModels.
 */
@ContributesTo(AppScope::class)
@SingleIn(AppScope::class)
interface AppViewModelMapComponent {

    /**
     * Map of simple ViewModel factories for ViewModels that have no assisted dependencies.
     */
    val viewModelMap: @ForScope(AppScope::class) ViewModelMap

    /**
     * Map of ViewModel factories that just require a [SavedStateHandle].
     */
    val savedStateViewModelMap: @ForScope(AppScope::class) SavedStateViewModelMap

    /**
     * Map of advanced ViewModel factories that require one or more assisted dependencies outside of [SavedStateHandle].
     */
    val viewModelFactoryMap: @ForScope(AppScope::class) ViewModelFactoryMap

    @Provides
    @SingleIn(AppScope::class)
    fun provideSimpleViewModelMap(
        map: Map<KClass<out ViewModel>, () -> ViewModel>
    ): @ForScope(AppScope::class) ViewModelMap = map

    @Provides
    @SingleIn(AppScope::class)
    fun provideSavedStateViewModelMap(
        map: Map<KClass<out ViewModel>, (SavedStateHandle) -> ViewModel>
    ): @ForScope(AppScope::class) SavedStateViewModelMap = map

    @Provides
    @SingleIn(AppScope::class)
    fun provideViewModelFactoryMap(
        map: Map<KClass<out ViewModel>, Any>
    ): @ForScope(AppScope::class) ViewModelFactoryMap = map
}
